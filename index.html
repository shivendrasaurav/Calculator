<html>
    <head>
        <title>Calculator</title>
        <link href="https://fluentdesignforweb.github.io/fluent.css" type="text/css" rel="stylesheet">
        <link href="extra.css" type="text/css" rel="stylesheet">
        <link href="Icons/css/fluent-icons.css" type="text/css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Web Calculator Based On Fluent Design">
        <script src="calc.js"></script>
        <script src="fluent.js"></script>
        <link rel='manifest' href='manifest.webmanifest'>
        <script src="pwabuilder-sw.js"></script>
        <script>
            
            let deferredPrompt = null;

            window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            });

            async function install() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                console.log(deferredPrompt)
                deferredPrompt.userChoice.then(function(choiceResult){

                if (choiceResult.outcome === 'accepted') {
                console.log('Your PWA has been installed');
                } else {
                console.log('User chose to not install your PWA');
                }

                deferredPrompt = null;

                });

            }
            closeinstaller();
            }

            function showinstaller(){
                document.getElementById("install_button_surface").style.display="Block";
                document.getElementById("head").style.filter="saturate(125%) blur(10px)";            
            }
            
            function closeinstaller(){
                document.getElementById("install_button_surface").style.display="none";
                document.getElementById("head").style.filter="saturate(100%) blur(0px)";            
            }

        </script>
        <script>
            function checkinstall(){
                if (window.matchMedia('(display-mode: standalone)').matches) {  
                    closeinstaller();
                    console.log('display-mode is standalone');
                }  
                else
                    showinstaller();
            }
        </script>
    </head>
    <body class="column large4 small12 medium8 center" onload="checkinstall();" onkeydown="keypress(event);" >
        <div id="head">
            <div class="calc_area_container"><textarea class="calc_area"></textarea></div>
            <div class="input_area">
                <div class="input_row">
                    <div class="column large3 medium3 small3 calc_input">
                        <button>1</button>
                    </div>
                </div>
                <div class="input_row">
                </div>
                <div class="input_row">
                </div>
                <div class="input_row">
                </div>
                <div class="input_row">
                </div>

            </div>
        </div>

    </div>


        <div class="modal_container" id="install_button_surface">
            <div class="modal_content">
                <br><br><br><br><br><br><br><br>
                <div class="column large6 medium8 small12 center">
                    <button class="circular primary_red right" style="width: 50px; height: 50px; padding: 0px;" onclick="closeinstaller()">
                        <i class="ms-Icon ms-Icon--Cancel"></i>
                    </button><br><br><br><br>
                    <button id="install_button" class="primary_blue center" onclick="install();" style="height: 100px; width: 300px; font-size: 28px;">
                        Install Calculator
                    </button>
                </div>
            </div>
        </div>
    </body>
    <script>
        // This is the "Offline copy of pages" service worker

        // Add this below content to your HTML page, or add the js file to your page at the very top to register service worker

        // Check compatibility for the browser we're running this in
        if ("serviceWorker" in navigator) {
            if (navigator.serviceWorker.controller) {
                console.log("[PWA Builder] active service worker found, no need to register");
            } else {
                // Register the service worker
                navigator.serviceWorker
                .register("pwabuilder-sw.js", {
                    scope: "./"
                })
                .then(function (reg) {
                    console.log("[PWA Builder] Service worker has been registered for scope: " + reg.scope);
                });
            }
        }
    </script>
    </html>
